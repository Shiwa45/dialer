# Generated by Django 5.0.7 on 2025-07-04 12:44

import django.core.validators
import django.db.models.deletion
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('calls', '0001_initial'),
        ('campaigns', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='AsteriskServer',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('name', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True)),
                ('server_id', models.CharField(default=uuid.uuid4, max_length=50, unique=True)),
                ('server_type', models.CharField(choices=[('single', 'Single Server'), ('master', 'Master Server'), ('slave', 'Slave Server')], default='single', max_length=20)),
                ('server_ip', models.GenericIPAddressField()),
                ('asterisk_version', models.CharField(blank=True, max_length=20)),
                ('ami_host', models.CharField(default='localhost', max_length=200)),
                ('ami_port', models.PositiveIntegerField(default=5038)),
                ('ami_username', models.CharField(max_length=100)),
                ('ami_password', models.CharField(max_length=100)),
                ('ami_secret', models.CharField(blank=True, max_length=100)),
                ('ari_host', models.CharField(default='localhost', max_length=200)),
                ('ari_port', models.PositiveIntegerField(default=8088)),
                ('ari_username', models.CharField(max_length=100)),
                ('ari_password', models.CharField(max_length=100)),
                ('ari_application', models.CharField(default='autodialer', max_length=100)),
                ('max_calls', models.PositiveIntegerField(default=100)),
                ('is_active', models.BooleanField(default=True)),
                ('is_recording_server', models.BooleanField(default=False)),
                ('last_connected', models.DateTimeField(blank=True, null=True)),
                ('connection_status', models.CharField(choices=[('connected', 'Connected'), ('disconnected', 'Disconnected'), ('error', 'Error'), ('unknown', 'Unknown')], default='unknown', max_length=20)),
            ],
            options={
                'verbose_name': 'Asterisk Server',
                'verbose_name_plural': 'Asterisk Servers',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='CallQueue',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('name', models.CharField(max_length=200)),
                ('extension', models.CharField(max_length=20, unique=True)),
                ('description', models.TextField(blank=True)),
                ('strategy', models.CharField(choices=[('ringall', 'Ring All'), ('leastrecent', 'Least Recent'), ('fewestcalls', 'Fewest Calls'), ('random', 'Random'), ('rrmemory', 'Round Robin Memory'), ('linear', 'Linear')], default='ringall', max_length=20)),
                ('timeout', models.PositiveIntegerField(default=300, help_text='Timeout in seconds')),
                ('max_waiting', models.PositiveIntegerField(default=0, help_text='0 = unlimited')),
                ('music_on_hold', models.CharField(default='default', max_length=100)),
                ('join_announcement', models.CharField(blank=True, max_length=500)),
                ('periodic_announcement', models.CharField(blank=True, max_length=500)),
                ('announce_position', models.BooleanField(default=True)),
                ('announce_holdtime', models.BooleanField(default=True)),
                ('retry_interval', models.PositiveIntegerField(default=30)),
                ('is_active', models.BooleanField(default=True)),
                ('asterisk_server', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='queues', to='telephony.asteriskserver')),
            ],
            options={
                'verbose_name': 'Call Queue',
                'verbose_name_plural': 'Call Queues',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='Carrier',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('name', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True)),
                ('carrier_id', models.CharField(default=uuid.uuid4, max_length=50, unique=True)),
                ('protocol', models.CharField(choices=[('sip', 'SIP'), ('iax2', 'IAX2'), ('dahdi', 'DAHDI'), ('pjsip', 'PJSIP')], default='sip', max_length=10)),
                ('server_ip', models.CharField(max_length=200)),
                ('port', models.PositiveIntegerField(default=5060)),
                ('username', models.CharField(max_length=100)),
                ('password', models.CharField(max_length=100)),
                ('auth_username', models.CharField(blank=True, max_length=100)),
                ('codec', models.CharField(default='ulaw,alaw,gsm', max_length=100)),
                ('dtmf_mode', models.CharField(default='rfc2833', max_length=20)),
                ('qualify', models.CharField(default='yes', max_length=20)),
                ('nat', models.CharField(default='force_rport,comedia', max_length=20)),
                ('max_channels', models.PositiveIntegerField(default=30)),
                ('cost_per_minute', models.DecimalField(decimal_places=4, default=0.0, max_digits=10)),
                ('priority', models.PositiveIntegerField(default=1)),
                ('is_active', models.BooleanField(default=True)),
                ('asterisk_server', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='carriers', to='telephony.asteriskserver')),
            ],
            options={
                'verbose_name': 'Carrier',
                'verbose_name_plural': 'Carriers',
                'ordering': ['priority', 'name'],
            },
        ),
        migrations.CreateModel(
            name='DialplanContext',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('name', models.CharField(max_length=100, unique=True)),
                ('description', models.TextField(blank=True)),
                ('is_active', models.BooleanField(default=True)),
                ('asterisk_server', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='contexts', to='telephony.asteriskserver')),
            ],
            options={
                'verbose_name': 'Dialplan Context',
                'verbose_name_plural': 'Dialplan Contexts',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='DID',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('phone_number', models.CharField(max_length=20, unique=True, validators=[django.core.validators.RegexValidator(message='Enter a valid phone number', regex='^\\+?1?\\d{9,15}$')])),
                ('name', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True)),
                ('did_type', models.CharField(choices=[('inbound', 'Inbound Only'), ('outbound', 'Outbound Only'), ('bidirectional', 'Bidirectional')], default='bidirectional', max_length=20)),
                ('is_active', models.BooleanField(default=True)),
                ('context', models.CharField(default='from-trunk', max_length=100)),
                ('extension', models.CharField(blank=True, max_length=20)),
                ('assigned_campaign', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_dids', to='campaigns.campaign')),
                ('asterisk_server', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='dids', to='telephony.asteriskserver')),
                ('carrier', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='telephony.carrier')),
            ],
            options={
                'verbose_name': 'DID',
                'verbose_name_plural': 'DIDs',
                'ordering': ['phone_number'],
            },
        ),
        migrations.CreateModel(
            name='IVR',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('name', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True)),
                ('ivr_id', models.CharField(default=uuid.uuid4, max_length=50, unique=True)),
                ('welcome_message', models.CharField(blank=True, max_length=500)),
                ('invalid_message', models.CharField(blank=True, max_length=500)),
                ('timeout_message', models.CharField(blank=True, max_length=500)),
                ('digit_timeout', models.PositiveIntegerField(default=3000, help_text='Timeout in milliseconds')),
                ('response_timeout', models.PositiveIntegerField(default=10000, help_text='Timeout in milliseconds')),
                ('max_retries', models.PositiveIntegerField(default=3)),
                ('allow_direct_dial', models.BooleanField(default=False)),
                ('play_exit_sound', models.BooleanField(default=True)),
                ('is_active', models.BooleanField(default=True)),
                ('asterisk_server', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ivrs', to='telephony.asteriskserver')),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'IVR',
                'verbose_name_plural': 'IVRs',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='Phone',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('extension', models.CharField(max_length=20, unique=True)),
                ('name', models.CharField(max_length=200)),
                ('phone_type', models.CharField(choices=[('sip', 'SIP Phone'), ('iax2', 'IAX2 Phone'), ('webrtc', 'WebRTC'), ('dahdi', 'DAHDI'), ('virtual', 'Virtual Phone')], default='sip', max_length=20)),
                ('secret', models.CharField(max_length=100)),
                ('host', models.CharField(default='dynamic', max_length=100)),
                ('context', models.CharField(default='agents', max_length=100)),
                ('codec', models.CharField(default='ulaw,alaw', max_length=100)),
                ('qualify', models.CharField(default='yes', max_length=20)),
                ('nat', models.CharField(default='force_rport,comedia', max_length=20)),
                ('call_waiting', models.BooleanField(default=True)),
                ('call_transfer', models.BooleanField(default=True)),
                ('three_way_calling', models.BooleanField(default=True)),
                ('voicemail', models.BooleanField(default=False)),
                ('is_active', models.BooleanField(default=True)),
                ('webrtc_enabled', models.BooleanField(default=False)),
                ('ice_host', models.CharField(blank=True, max_length=200)),
                ('asterisk_server', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='phones', to='telephony.asteriskserver')),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='phones', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Phone',
                'verbose_name_plural': 'Phones',
                'ordering': ['extension'],
            },
        ),
        migrations.CreateModel(
            name='QueueMember',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('penalty', models.PositiveIntegerField(default=0)),
                ('is_active', models.BooleanField(default=True)),
                ('paused', models.BooleanField(default=False)),
                ('phone', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='telephony.phone')),
                ('queue', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='telephony.callqueue')),
            ],
            options={
                'verbose_name': 'Queue Member',
                'verbose_name_plural': 'Queue Members',
                'unique_together': {('queue', 'phone')},
            },
        ),
        migrations.AddField(
            model_name='callqueue',
            name='members',
            field=models.ManyToManyField(related_name='queues', through='telephony.QueueMember', to='telephony.phone'),
        ),
        migrations.CreateModel(
            name='DialplanExtension',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('extension', models.CharField(max_length=100)),
                ('priority', models.PositiveIntegerField(default=1)),
                ('application', models.CharField(max_length=100)),
                ('arguments', models.TextField(blank=True)),
                ('is_active', models.BooleanField(default=True)),
                ('context', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='extensions', to='telephony.dialplancontext')),
            ],
            options={
                'verbose_name': 'Dialplan Extension',
                'verbose_name_plural': 'Dialplan Extensions',
                'ordering': ['extension', 'priority'],
                'unique_together': {('context', 'extension', 'priority')},
            },
        ),
        migrations.CreateModel(
            name='IVROption',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('digit', models.CharField(max_length=1)),
                ('description', models.CharField(max_length=200)),
                ('action_type', models.CharField(choices=[('extension', 'Transfer to Extension'), ('queue', 'Transfer to Queue'), ('voicemail', 'Send to Voicemail'), ('hangup', 'Hang Up'), ('repeat', 'Repeat Menu'), ('sub_menu', 'Go to Sub Menu'), ('campaign', 'Route to Campaign')], max_length=20)),
                ('action_value', models.CharField(max_length=200)),
                ('option_message', models.CharField(blank=True, max_length=500)),
                ('sort_order', models.PositiveIntegerField(default=0)),
                ('is_active', models.BooleanField(default=True)),
                ('ivr', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='options', to='telephony.ivr')),
            ],
            options={
                'verbose_name': 'IVR Option',
                'verbose_name_plural': 'IVR Options',
                'ordering': ['sort_order', 'digit'],
                'unique_together': {('ivr', 'digit')},
            },
        ),
        migrations.CreateModel(
            name='Recording',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('filename', models.CharField(max_length=500)),
                ('file_path', models.CharField(max_length=1000)),
                ('file_size', models.PositiveIntegerField(default=0)),
                ('duration', models.PositiveIntegerField(default=0, help_text='Duration in seconds')),
                ('call_id', models.CharField(max_length=100)),
                ('channel', models.CharField(blank=True, max_length=200)),
                ('format', models.CharField(default='wav', max_length=10)),
                ('is_available', models.BooleanField(default=True)),
                ('recording_start', models.DateTimeField()),
                ('recording_end', models.DateTimeField(blank=True, null=True)),
                ('asterisk_server', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='recordings', to='telephony.asteriskserver')),
                ('call_log', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='recordings', to='calls.calllog')),
            ],
            options={
                'verbose_name': 'Recording',
                'verbose_name_plural': 'Recordings',
                'ordering': ['-recording_start'],
                'indexes': [models.Index(fields=['call_id'], name='telephony_r_call_id_af0e3b_idx'), models.Index(fields=['recording_start'], name='telephony_r_recordi_4e94c1_idx')],
            },
        ),
    ]
