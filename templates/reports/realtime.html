{% extends 'reports/base.html' %}

{% block page_title %}<i class="fas fa-bolt text-primary"></i> Realtime{% endblock %}
{% block page_description %}Recent 30 minutes activity (auto-refresh with browser reload){% endblock %}

{% block reports_content %}
<div class="row g-3 mb-3">
  <div class="col-sm-6 col-lg-3"><div class="card card-report"><div class="card-body"><div class="metric">{{ stats.calls|default:0 }}</div><div class="metric-label">Calls (30m)</div></div></div></div>
  <div class="col-sm-6 col-lg-3"><div class="card card-report"><div class="card-body"><div class="metric">{{ stats.answered|default:0 }}</div><div class="metric-label">Answered</div></div></div></div>
  <div class="col-sm-6 col-lg-3"><div class="card card-report"><div class="card-body"><div class="metric">{{ stats.sales|default:0 }}</div><div class="metric-label">Sales</div></div></div></div>
  <div class="col-sm-6 col-lg-3"><div class="card card-report"><div class="card-body"><div class="metric">{{ stats.avg_talk|default:0|floatformat:0 }}s</div><div class="metric-label">Avg Talk</div></div></div></div>
  </div>

<div class="card card-report">
  <div class="card-body">
    <h5 class="card-title mb-3"><i class="fas fa-list text-primary"></i> Latest Calls</h5>
    <div class="table-responsive">
      <table class="table table-striped table-report mb-0">
        <thead><tr><th>Time</th><th>Agent</th><th>Campaign</th><th>Number</th><th>Status</th><th>Disposition</th><th class="text-end">Talk (s)</th></tr></thead>
        <tbody>
        {% for c in recent_calls %}
          <tr>
            <td>{{ c.start_time }}</td>
            <td>{{ c.agent.username|default:'-' }}</td>
            <td>{{ c.campaign.name|default:'-' }}</td>
            <td>{{ c.called_number }}</td>
            <td>{{ c.get_call_status_display }}</td>
            <td>{{ c.disposition.name|default:'-' }}</td>
            <td class="text-end">{{ c.talk_duration }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="7" class="text-center text-muted">No recent calls</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  // Basic auto-refresh every 30 seconds
  setTimeout(function(){ window.location.reload(); }, 30000);
  </script>
{% endblock %}

