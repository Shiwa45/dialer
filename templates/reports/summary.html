{% extends 'reports/base.html' %}

{% block page_title %}<i class="fas fa-chart-pie text-primary"></i> Summary{% endblock %}
{% block page_description %}Overall performance and daily trends{% endblock %}
{% block export_links %}
  <a class="btn btn-sm btn-outline-primary" href="{% url 'reports:export' 'summary' 'csv' %}?{{ request.GET.urlencode }}"><i class="fas fa-file-csv"></i> CSV</a>
  <a class="btn btn-sm btn-outline-primary" href="{% url 'reports:export' 'summary' 'xlsx' %}?{{ request.GET.urlencode }}"><i class="fas fa-file-excel"></i> Excel</a>
  <a class="btn btn-sm btn-outline-primary" href="{% url 'reports:export' 'summary' 'pdf' %}?{{ request.GET.urlencode }}"><i class="fas fa-file-pdf"></i> PDF</a>
{% endblock %}

{% block reports_content %}
{% include 'reports/_filters.html' %}

<div class="row g-3 mb-4">
  <div class="col-sm-6 col-lg-3">
    <div class="card card-report"><div class="card-body">
      <div class="metric">{{ totals.total_calls|default:0 }}</div>
      <div class="metric-label">Total Calls</div>
    </div></div>
  </div>
  <div class="col-sm-6 col-lg-3">
    <div class="card card-report"><div class="card-body">
      <div class="metric">{{ totals.answered|default:0 }}</div>
      <div class="metric-label">Answered</div>
    </div></div>
  </div>
  <div class="col-sm-6 col-lg-3">
    <div class="card card-report"><div class="card-body">
      <div class="metric">{{ totals.sales|default:0 }}</div>
      <div class="metric-label">Sales</div>
    </div></div>
  </div>
  <div class="col-sm-6 col-lg-3">
    <div class="card card-report"><div class="card-body">
      <div class="metric">{{ contact_rate }}% / {{ conversion_rate }}%</div>
      <div class="metric-label">Contact / Conversion</div>
    </div></div>
  </div>
</div>

<div class="card card-report">
  <div class="card-body">
    <h5 class="card-title mb-3"><i class="fas fa-chart-area text-primary"></i> Daily Trends</h5>
    <canvas id="trendChart" height="80"></canvas>
  </div>
  <div class="table-responsive p-3">
    <table class="table table-striped table-report mb-0">
      <thead><tr><th>Date</th><th>Calls</th><th>Answered</th><th>Sales</th></tr></thead>
      <tbody>
        {% for d in daily %}
          <tr>
            <td>{{ d.day }}</td>
            <td>{{ d.calls }}</td>
            <td>{{ d.answered }}</td>
            <td>{{ d.sales }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="4" class="text-center text-muted">No data for selected period</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const labels = [{% for d in daily %}'{{ d.day }}',{% endfor %}];
  const calls = [{% for d in daily %}{{ d.calls }},{% endfor %}];
  const answered = [{% for d in daily %}{{ d.answered }},{% endfor %}];
  const sales = [{% for d in daily %}{{ d.sales }},{% endfor %}];
  new Chart(document.getElementById('trendChart'), {
    type: 'line',
    data: { labels, datasets: [
      { label: 'Calls', data: calls, borderColor: '#667eea', backgroundColor: 'rgba(102,126,234,0.15)', tension: .3 },
      { label: 'Answered', data: answered, borderColor: '#28a745', backgroundColor: 'rgba(40,167,69,0.15)', tension: .3 },
      { label: 'Sales', data: sales, borderColor: '#ff6b6b', backgroundColor: 'rgba(255,107,107,0.15)', tension: .3 }
    ]},
    options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
  });
</script>
{% endblock %}

